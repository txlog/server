<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="/images/favicon.ico">
  <link rel="shortcut icon" href="/images/favicon.ico">
  <title>Txlog Server</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@500;600;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://unpkg.com/lucide@latest"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@5.3.6/dist/apexcharts.min.css">
</head>

<body class="font-sans antialiased">
  <nav class="fixed top-0 left-0 right-0 bg-txlog-indigo z-50 print:hidden">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center gap-6">
          <a href="/" class="flex items-center gap-3">
            <img src="/images/logbook.png" class="h-8 w-auto" alt="Txlog Server">
            <span class="text-white font-display font-semibold text-lg hidden sm:inline">Txlog Server</span>
          </a>
          <div class="hidden md:flex items-center gap-1">
            <a href="/"
              class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium">
              <i data-lucide="home" class="w-4 h-4"></i>
              Home
            </a>
            <a href="/assets"
              class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium">
              <i data-lucide="server" class="w-4 h-4"></i>
              Assets
            </a>
            <a href="/packages"
              class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium">
              <i data-lucide="package" class="w-4 h-4"></i>
              Packages
            </a>
            <div class="relative" id="reports-dropdown">
              <button onclick="toggleDropdown('reports-menu')"
                class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium">
                <i data-lucide="chart-no-axes-combined" class="w-4 h-4"></i>
                Reports
                <i data-lucide="chevron-down" class="w-3 h-3"></i>
              </button>
              <div id="reports-menu"
                class="hidden absolute top-full left-0 mt-1 w-52 bg-white rounded-xl shadow-xl border border-txlog-lavender/30 py-2 z-50">
                <a class="block px-4 py-2 text-sm text-txlog-indigo hover:bg-txlog-lavender/30 transition-colors"
                  href="/package-progression">Package Progression</a>
                <a class="block px-4 py-2 text-sm text-txlog-indigo hover:bg-txlog-lavender/30 transition-colors"
                  href="/analytics/compare">Package Comparison</a>
                <a class="block px-4 py-2 text-sm text-txlog-indigo hover:bg-txlog-lavender/30 transition-colors"
                  href="/analytics/freshness">Package Freshness</a>
                <a class="block px-4 py-2 text-sm text-txlog-indigo hover:bg-txlog-lavender/30 transition-colors"
                  href="/analytics/adoption">Package Adoption</a>
                <a class="block px-4 py-2 text-sm text-txlog-indigo hover:bg-txlog-lavender/30 transition-colors"
                  href="/analytics/anomalies">Anomaly Detection</a>
              </div>
            </div>
            {{ if not (or .Context.Keys.oidc_enabled .Context.Keys.ldap_enabled) }}
            <a href="/admin"
              class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium">
              <i data-lucide="settings" class="w-4 h-4"></i>
              Admin
            </a>
            {{ end }}
          </div>
        </div>
        <div class="flex items-center gap-3">
          {{ if not .Context.Keys.user }}
          {{ $latestVersion := .Context.Keys.env.latestVersion }}
          {{ if and $latestVersion (ne $latestVersion "") (not (versionsEqual $latestVersion (version))) }}
          <a href="https://github.com/txlog/server/releases/tag/{{ $latestVersion }}"
            class="hidden xl:inline-flex items-center gap-1.5 bg-txlog-coral/10 text-txlog-coral text-xs font-bold px-2.5 py-1 rounded-md hover:bg-txlog-coral/20 transition-colors">
            New version: {{ $latestVersion }}
            <i data-lucide="external-link" class="w-3 h-3"></i>
          </a>
          {{ end }}
          <span class="hidden xl:inline-block bg-white/15 text-white/90 text-xs font-medium px-2.5 py-1 rounded-md">{{
            .Context.Keys.env.instance }}</span>
          {{ end }}
          {{ if .Context.Keys.user }}
          <div class="relative" id="user-dropdown">
            <button onclick="toggleDropdown('user-menu')"
              class="flex items-center gap-2 text-white p-0 hover:opacity-90 transition-opacity">
              {{ if .Context.Keys.user.Picture }}
              <span class="w-8 h-8 rounded-lg overflow-hidden bg-txlog-lavender">
                <img src="{{ .Context.Keys.user.Picture }}" class="w-full h-full object-cover" alt="">
              </span>
              {{ else }}
              <span
                class="w-8 h-8 rounded-lg bg-txlog-lavender flex items-center justify-center text-xs font-bold text-txlog-indigo">{{
                initial .Context.Keys.user.Name }}</span>
              {{ end }}
              <div class="hidden xl:block text-left">
                <div class="text-sm font-medium leading-none">{{ .Context.Keys.user.Name }}</div>
                <div class="text-xs text-white/60 mt-0.5">{{ .Context.Keys.user.Email }}</div>
              </div>
            </button>
            <div id="user-menu"
              class="hidden absolute top-full right-0 mt-2 w-56 bg-white rounded-xl shadow-xl border border-txlog-lavender/30 py-2 z-50">
              {{ $latestVersion := .Context.Keys.env.latestVersion }}
              {{ if and $latestVersion (ne $latestVersion "") (not (versionsEqual $latestVersion (version))) }}
              <div class="px-4 py-2">
                <a href="https://github.com/txlog/server/releases/tag/{{ $latestVersion }}"
                  class="inline-flex items-center gap-1.5 bg-txlog-coral/10 text-txlog-coral text-xs font-bold px-2.5 py-1 rounded-md hover:bg-txlog-coral/20 transition-colors">
                  New version: {{ $latestVersion }}
                  <i data-lucide="external-link" class="w-3 h-3"></i>
                </a>
              </div>
              {{ end }}
              <div class="border-t border-txlog-lavender/50 my-1"></div>
              <div class="px-4 py-1 text-xs font-bold text-txlog-indigo/50 uppercase">{{ .Context.Keys.env.instance }}
              </div>
              {{ if .Context.Keys.user.IsAdmin }}
              <div class="border-t border-txlog-lavender/50 my-1"></div>
              <a class="flex items-center gap-2 px-4 py-2 text-sm text-txlog-indigo hover:bg-txlog-lavender/30 transition-colors"
                href="/admin">
                <i data-lucide="settings" class="w-4 h-4"></i>
                Administration
              </a>
              {{ end }}
              <div class="border-t border-txlog-lavender/50 my-1"></div>
              <form action="/auth/logout" method="post">
                <button type="submit"
                  class="flex items-center gap-2 px-4 py-2 text-sm text-txlog-indigo hover:bg-txlog-lavender/30 transition-colors w-full text-left">
                  <i data-lucide="log-out" class="w-4 h-4"></i>
                  Logout
                </button>
              </form>
            </div>
          </div>
          {{ end }}
          <button onclick="document.getElementById('mobile-menu').classList.toggle('hidden')"
            class="md:hidden text-white p-1.5 rounded-lg hover:bg-white/10 transition-colors"
            aria-label="Toggle navigation">
            <i data-lucide="menu" class="w-5 h-5"></i>
          </button>
        </div>
      </div>
      <div id="mobile-menu" class="hidden md:hidden pb-4 border-t border-white/10 mt-2 pt-3 space-y-1">
        <a href="/"
          class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium">
          <i data-lucide="home" class="w-4 h-4"></i> Home
        </a>
        <a href="/assets"
          class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium">
          <i data-lucide="server" class="w-4 h-4"></i> Assets
        </a>
        <a href="/packages"
          class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium">
          <i data-lucide="package" class="w-4 h-4"></i> Packages
        </a>
        <a href="/package-progression"
          class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium pl-6">
          Package Progression
        </a>
        <a href="/analytics/compare"
          class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium pl-6">
          Package Comparison
        </a>
        <a href="/analytics/freshness"
          class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium pl-6">
          Package Freshness
        </a>
        <a href="/analytics/adoption"
          class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium pl-6">
          Package Adoption
        </a>
        <a href="/analytics/anomalies"
          class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium pl-6">
          Anomaly Detection
        </a>
        {{ if not (or .Context.Keys.oidc_enabled .Context.Keys.ldap_enabled) }}
        <a href="/admin"
          class="flex items-center gap-2 px-3 py-2 rounded-xl text-white/80 hover:text-white hover:bg-white/10 transition-all text-sm font-medium">
          <i data-lucide="settings" class="w-4 h-4"></i> Admin
        </a>
        {{ end }}
      </div>
    </div>
  </nav>
  <main class="pt-20 min-h-screen">
