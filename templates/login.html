<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>{{ .title }}</title>
  <link rel="icon" href="/images/favicon.ico">
  <link rel="shortcut icon" href="/images/favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@500;600;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="font-sans antialiased min-h-screen flex items-center justify-center">
  <div class="w-full max-w-md mx-auto px-4 py-8">
    <div class="text-center mb-6">
      <a href="/"><img src="/images/logbook.png" height="100" width="100" alt="Txlog Server" class="inline-block"></a>
    </div>
    <div class="bg-white rounded-3xl shadow-soft p-8">
      <h2 class="font-display font-bold text-2xl text-center mb-6">Login to your account</h2>

      <div id="error-container">
        <script>
          var urlParams = new URLSearchParams(window.location.search);
          var error = urlParams.get('error');
          if (error) {
            var errorMessage = 'An error occurred during authentication.';
            var errorTitle = 'Authentication Error';
            switch (error) {
              case 'auth_failed': errorMessage = 'Authentication failed. Please check your credentials and try again.'; break;
              case 'invalid_state': errorMessage = 'Invalid request state. Please try again.'; break;
              case 'token_exchange_failed': errorMessage = 'Failed to exchange authorization code.'; break;
              case 'id_token_missing': errorMessage = 'ID token is missing from the response.'; break;
              case 'id_token_invalid': errorMessage = 'ID token verification failed.'; break;
              case 'user_creation_failed': errorMessage = 'Failed to create or update user account.'; break;
              case 'account_disabled': errorMessage = 'Your account has been disabled. Please contact an administrator.'; break;
              case 'session_creation_failed': errorMessage = 'Failed to create user session.'; break;
              case 'invalid_credentials': errorMessage = 'Invalid username or password.'; break;
              case 'user_not_found': errorMessage = 'User not found in the directory. Please check your username.'; break;
              case 'unauthorized_group': errorMessage = 'You are not authorized to access this system. Please contact an administrator.'; break;
              case 'ldap_connection_error': errorTitle = 'LDAP Connection Error'; errorMessage = 'Unable to connect to the authentication server. Please contact an administrator.'; break;
              case 'ldap_bind_error': errorTitle = 'LDAP Configuration Error'; errorMessage = 'Authentication service is misconfigured. Please contact an administrator to check the service account settings.'; break;
              case 'ldap_config_error': errorTitle = 'LDAP Configuration Error'; errorMessage = 'Authentication service has a configuration issue. Please contact an administrator to verify the directory settings.'; break;
            }
            document.getElementById('error-container').innerHTML =
              '<div class="mb-4 bg-txlog-coral/10 border border-txlog-coral/30 rounded-xl p-4">' +
              '<div class="flex items-start gap-3">' +
              '<i data-lucide="triangle-alert" class="w-5 h-5 text-txlog-coral mt-0.5 flex-shrink-0"></i>' +
              '<div>' +
              '<h4 class="font-semibold text-sm text-txlog-coral">' + errorTitle + '</h4>' +
              '<p class="text-sm text-txlog-indigo/70 mt-1">' + errorMessage + '</p>' +
              '</div>' +
              '</div>' +
              '</div>';
            lucide.createIcons();
          }
        </script>
      </div>

      {{ if .ldap_enabled }}
      <form action="/auth/ldap/login" method="post" autocomplete="off" novalidate>
        <div class="mb-4">
          <label class="font-medium text-sm pl-1 block mb-1.5">Username</label>
          <input type="text" name="username" placeholder="john.doe" autocomplete="off" required
            class="w-full border-2 border-txlog-lavender bg-white/50 px-4 py-3 rounded-xl outline-none focus:border-txlog-sky focus:ring-4 focus:ring-txlog-sky/20 transition-all placeholder:text-txlog-indigo/30 text-txlog-indigo font-medium">
        </div>
        <div class="mb-4">
          <label class="font-medium text-sm pl-1 block mb-1.5">Password</label>
          <input type="password" name="password" placeholder="**********" autocomplete="off" required
            class="w-full border-2 border-txlog-lavender bg-white/50 px-4 py-3 rounded-xl outline-none focus:border-txlog-sky focus:ring-4 focus:ring-txlog-sky/20 transition-all placeholder:text-txlog-indigo/30 text-txlog-indigo font-medium">
        </div>
        <button type="submit"
          class="w-full bg-txlog-coral text-white font-medium py-3 rounded-xl hover:-translate-y-0.5 hover:shadow-lg hover:shadow-txlog-coral/30 transition-all">
          Sign in
        </button>
      </form>
      {{ end }}

      {{ if and .oidc_enabled .ldap_enabled }}
      <div class="flex items-center gap-3 my-5">
        <div class="flex-1 h-px bg-txlog-lavender"></div>
        <span class="text-sm text-txlog-indigo/50 font-medium">or</span>
        <div class="flex-1 h-px bg-txlog-lavender"></div>
      </div>
      {{ end }}

      {{ if .oidc_enabled }}
      <form action="/auth/login" method="post" autocomplete="off" novalidate>
        <button type="submit"
          class="w-full border-2 border-txlog-indigo text-txlog-indigo font-medium py-2.5 rounded-xl hover:bg-txlog-lavender/30 transition-all flex items-center justify-center gap-2">
          <i data-lucide="shield-check" class="w-5 h-5"></i>
          Login with SSO
        </button>
      </form>
      {{ end }}
    </div>
  </div>
  <script>lucide.createIcons();</script>
</body>

</html>
