{{ template "header.html" . }}
<div class="bg-txlog-indigo -mt-4 pt-4 pb-6 mb-6 print:hidden">
  <div class="max-w-7xl mx-auto px-6">
    <h2 class="font-display font-bold text-2xl text-white">{{ .title }}</h2>
  </div>
</div>

<div class="max-w-7xl mx-auto px-6 pb-8">
  <div class="bg-white rounded-3xl shadow-soft overflow-hidden">
    <div
      class="border-b border-txlog-lavender px-6 py-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <h3 class="font-display font-semibold text-lg">
        {{ if .search }}
        Registered packages containing <kbd
          class="bg-txlog-indigo/5 text-txlog-indigo text-xs font-mono px-2 py-1 rounded-md">{{ .search }}</kbd>
        {{ else }}
        Registered packages
        {{ end }}
      </h3>
      <div class="flex items-center gap-2">
        <input type="text" autocomplete="off" aria-label="Search packages" placeholder="Search by package name"
          value="{{ .search }}" id="search" name="search" onkeydown="handleSearch(event)"
          class="border-2 border-txlog-lavender bg-white/50 px-3 py-2 rounded-xl outline-none focus:border-txlog-sky focus:ring-4 focus:ring-txlog-sky/20 transition-all placeholder:text-txlog-indigo/30 text-txlog-indigo text-sm font-medium w-48 sm:w-64">
        <button onclick="search()"
          class="bg-txlog-sky text-white p-2 rounded-xl hover:-translate-y-0.5 hover:shadow-lg hover:shadow-txlog-sky/30 transition-all"
          aria-label="Search">
          <i data-lucide="search" class="w-4 h-4"></i>
        </button>
      </div>
    </div>

    {{ if eq (len .packageNames) 0 }}
    <div class="py-16 text-center">
      <i data-lucide="frown" class="w-12 h-12 text-txlog-indigo/20 mx-auto mb-4"></i>
      <p class="font-display font-semibold text-lg mb-2">No packages found{{ if .search }} containing <kbd
          class="bg-txlog-indigo/5 text-xs font-mono px-2 py-1 rounded-md">{{ .search }}</kbd>{{ end }}</p>
      <p class="text-sm text-txlog-indigo/50">Start by running <a href="https://txlog.rda.run/docs/agent"
          target="_blank" class="text-txlog-sky hover:underline">Txlog Agent</a> in one of your servers.</p>
    </div>
    {{ else }}
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b border-txlog-lavender/50 text-left">
            <th class="px-6 py-3 font-semibold text-txlog-indigo/70 text-xs uppercase tracking-wider">
              Name <i data-lucide="chevron-up" class="w-3 h-3 inline-block"></i>
            </th>
            <th class="px-6 py-3 font-semibold text-txlog-indigo/70 text-xs uppercase tracking-wider">
              Version-Release-Arch</th>
            <th class="px-6 py-3 font-semibold text-txlog-indigo/70 text-xs uppercase tracking-wider">Assets</th>
            <th class="px-6 py-3 font-semibold text-txlog-indigo/70 text-xs uppercase tracking-wider">Repo</th>
            <th class="px-6 py-3 w-1">&nbsp;</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-txlog-lavender/30">
          {{ with .packageNames }}
          {{ range . }}
          <tr class="hover:bg-txlog-lavender/10 transition-colors">
            <td class="px-6 py-3 font-medium">{{ .Package }}</td>
            <td class="px-6 py-3">
              <span class="font-semibold">{{ .Version }}-{{ .Release }}</span><span class="text-txlog-indigo/50">-{{
                .Arch }}</span>
              {{ if ne .TotalVersions 0 }}
              <span class="text-txlog-indigo/50 text-xs"> (and {{ .TotalVersions }} more)</span>
              {{ end }}
            </td>
            <td class="px-6 py-3 text-txlog-indigo/60">{{ .MachineCount }}</td>
            <td class="px-6 py-3 text-txlog-indigo/60">{{ .Repo }}</td>
            <td class="px-6 py-3">
              <a class="text-txlog-sky hover:underline text-sm font-medium" href="/packages/{{ .Package }}">Details</a>
            </td>
          </tr>
          {{ end }}
          {{ end }}
        </tbody>
      </table>
    </div>

    <div class="border-t border-txlog-lavender/50 px-6 py-4 flex items-center justify-between">
      <p class="text-sm text-txlog-indigo/50">Showing <span>{{ add $.offset 1 }}</span> to <span>{{ min (add $.offset
          $.limit) $.totalRecords }}</span> of <span>{{ .totalRecords }}</span> entries</p>
      <div class="flex items-center gap-1">
        <a class="px-3 py-1.5 rounded-lg text-sm font-medium {{ if eq $.page 1 }}text-txlog-indigo/30 pointer-events-none{{ else }}text-txlog-indigo hover:bg-txlog-lavender/30{{ end }} transition-colors"
          href="?page={{ .page | add -1 }}">
          <i data-lucide="chevron-left" class="w-4 h-4 inline-block"></i> prev
        </a>
        {{ range $i := iterate 1 .totalPages }}
        <a class="px-3 py-1.5 rounded-lg text-sm font-medium {{ if eq $.page $i }}bg-txlog-sky text-white{{ else }}text-txlog-indigo hover:bg-txlog-lavender/30{{ end }} transition-colors"
          href="?page={{ $i }}">{{ $i }}</a>
        {{ end }}
        <a class="px-3 py-1.5 rounded-lg text-sm font-medium {{ if eq $.page $.totalPages }}text-txlog-indigo/30 pointer-events-none{{ else }}text-txlog-indigo hover:bg-txlog-lavender/30{{ end }} transition-colors"
          href="?page={{ .page | add 1 }}">
          next <i data-lucide="chevron-right" class="w-4 h-4 inline-block"></i>
        </a>
      </div>
    </div>
    {{ end }}
  </div>
</div>

<script>
  function search() {
    var searchValue = document.getElementById('search').value;
    var url = new URL(window.location.href);
    url.searchParams.set('search', searchValue);
    window.location.href = url.toString();
  }
  function handleSearch(event) {
    if (event.key === 'Enter') search();
  }
</script>
{{ template "footer.html" . }}
